<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loan Request Submission</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- ✅ Include in your HTML <head> or before closing </body> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      

    <style>
      .container-split {
        display: flex;
        height: 100vh;
      }
.table-bordered th {
  background-color: #0d6efd !important;
  color: white !important;
  vertical-align: middle;
}

      .left-container {
        width: 30%;
        padding: 20px;
        border-right: 2px solid #ddd;
      }
      .right-container {
        width: 70%;
        padding-left: 20px;
        padding-right: 20px;
        padding-bottom: 20px;
        overflow-y: auto;
      }

.preview-img {
  border: 2px solid #ccc;
  border-radius: 8px;
  padding: 5px;
  max-width: 90%;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
  display: block;
  margin-left: auto;
  margin-right: auto;
}



      .right-container::before {
        content: "";
        position: sticky;
        top: 0;
        height: 10px;
        background: white;
        z-index: 998;
        display: block;
      }

      .loading {
        display: none;
        text-align: center;
        font-size: 24px;
      }
      .result {
        display: none;
        text-align: center;
      }
      .preview-heading {
        text-align: center;
        font-weight: bold;
        margin: 20px 0;
      }
      .preview-heading1 {
        text-align: left;
        font-weight: bold;
        margin: 20px 0;
      }
      .pdf-preview {
        width: 100%;
        border: 2px solid #ccc;
        border-radius: 5px;
        padding: 5px;
      }

      .data-table {
        width: 75%;
        margin: 20px auto;
      }
      .edit-btn {
        float: right;
        margin-bottom: 10px;
        margin-left: 20px;
      }

      .bg-green > td {
  background-color: #b4e1c3 !important; /* deeper mint green */
}

.bg-yellow > td {
  background-color: #f4d27a !important; /* stronger amber yellow */
}

.bg-red > td {
  background-color: #f1a5a5 !important; /* richer rose red */
}


      .tab-container {
        display: flex;
        position: sticky;
        top: 0;
        background-color: white;
        z-index: 999;
        gap: 10px;
        padding: 10px;
      }
      .tab-button {
        padding: 8px 16px;
        border-radius: 8px;
        background-color: lightgray;
        cursor: pointer;
        font-weight: bold;
        border: 1px solid #ccc;
        color: black;
        transition: all 0.2s ease-in-out;
      }
      .tab-button.active {
        background-color: #0d6efd;
        color: white;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }

      #batelcoPL, #batelcoBS, #nikePL, #nikeBS {
  display: none !important;
  visibility: hidden !important;
  height: 0 !important;
  overflow: hidden !important;
}

button[onclick*="batelcoPLTable"], 
button[onclick*="batelcoBSTable"] {
  display: none !important;
}


    </style>
  </head>
  <body>
    <div class="container-split">
      <div class="left-container">

<div class="tab-container" style="gap: 6px;">
  <button class="tab-button active" id="tabNew" onclick="switchLeftTab('newRequest')">New Loan Request</button>
  <button class="tab-button" id="tabAll" onclick="switchLeftTab('allRequests')">All Requests</button>
</div>

        <br />
        <br />
<div id="newRequest" style="display: block;">
        <h3 class="preview-heading1">New Loan Request</h3>

        <form id="loanForm">
<div class="mb-3">
  <label for="requestId" class="form-label">Request ID</label>
  <input type="text" class="form-control" id="requestId" placeholder="Enter Request ID">
</div>
          <div class="mb-3">
            <br />
            <label class="form-label">Submit Statement of Profit & Loss</label>
            <input
              type="file"
              class="form-control"
              id="profitLoss"
              accept="*/*"
              required
            />
          </div>
          <br />
          <div class="mb-3">
            <label class="form-label"
              >Submit Statement of Financial Position</label
            >
            <input
              type="file"
              class="form-control"
              id="financialPosition"
              accept="*/*"
              required
            />
          </div>
          <br />
          <button type="submit" class="btn btn-success">Submit</button>
        </form>
<div id="uploadError" style="color: red; display: none; margin-top: 10px;"></div>
</div>

<div id="allRequests" style="display: none; margin-top: 20px;">
  <h4>All Loan Requests</h4>
  <table class="table table-bordered text-center" id="allRequestsTable">
    <thead>
      <tr>
        <th>Request ID</th>
        <th>Business</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>Etisalat</td><td>Approved</td></tr>
      <tr><td>2</td><td>DEWA</td><td>Approved</td></tr>
      <tr><td>3</td><td>ADNOC</td><td>Approved</td></tr>
      <tr><td>4</td><td>Shams Building and Construction</td><td>Rejected</td></tr>
    </tbody>
  </table>
</div>


      </div>

      <div class="right-container">
        <div class="tab-container" id="tabSwitcher" style="display: none">
          <div
            class="tab-button active"
            onclick="switchTab('tab-results', this)"
          >
            Results
          </div>
          <div class="tab-button" onclick="switchTab('tab-audit', this)">
            Audit History
          </div>
          <div class="tab-button" onclick="switchTab('tab-chatbot', this)">
            Ask SAS Chatbot
          </div>
        </div>

        <!-- Your current result content stays as-is below this -->

        <div class="loading" id="loading">
          <p>Processing...</p>
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>

        <div class="result" id="result">

        

          <div id="tab-results" class="tab-content active">
            <br />
            <br />

<div class="container mt-4">
  <div class="row">
    <!-- Company Information -->
    <div class="col-md-6">
  <h5><strong>Company Information</strong></h5>
  <table class="table table-bordered" id="rakCompanyInfo" style="display: table;">
    <tbody>
      <tr><th>Business Name</th><td>RAK Ceramics P.J.S.C.</td></tr>
      <tr><th>Type of Business</th><td>Public Joint Stock Company (P.J.S.C.)</td></tr>
      <tr><th>Sector/Industry</th><td>Manufacturing – Ceramics & Sanitaryware</td></tr>
      <tr><th>Business Age</th><td>36 years (Established in 1989)</td></tr>
      <tr><th>Registered Address</th>
        <td>P.O. Box 4714, Al Jazeera Al Hamra,<br>Ras Al Khaimah, United Arab Emirates</td></tr>
    </tbody>
  </table>
  <!-- Add Batelco version just below, default hidden -->
  <table class="table table-bordered" id="batelcoCompanyInfo" style="display: none;">
    <tbody>
      <tr><th>Business Name</th><td>Bahrain Telecommunications Company (Batelco) B.S.C.</td></tr>
      <tr><th>Type of Business</th><td>Public Bahraini Shareholding Company (B.S.C.)</td></tr>
      <tr><th>Sector/Industry</th><td>Telecommunications</td></tr>
      <tr><th>Business Age</th><td>43 years (Established in 1981)</td></tr>
      <tr><th>Registered Address</th>
        <td>P.O. Box 14, Manama, Kingdom of Bahrain</td>
      </tr>
    </tbody>
  </table>
</div>


    <!-- Loan Request Details -->
    <div class="col-md-6">
      <h5><strong>Loan Request Details</strong></h5>
      <table class="table table-bordered">
        <tbody>
          <tr><th>Loan Purpose</th><td>Expansion of production capacity to meet increasing global demand</td></tr>
          <tr><th>Requested Loan Amount</th><td>BD 50,000</td></tr>
          <tr><th>Tenure</th><td>7 years</td></tr>
          <tr><th>Proposed Repayment Schedule</th><td>Quarterly installments</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


            <h3 class="preview-heading">Preview: Statement of Profit & Loss</h3>
            <div class="text-center">
  <img id="incomePreviewImage" src="" class="img-fluid my-2 preview-img" style="display: none;" />
</div>

            <br />
            <br /><br />
            <br />

            <h3 class="preview-heading">
              Preview: Statement of Financial Position
            <div class="text-center">
              
  <img id="balancePreviewImage" src="" class="img-fluid my-2 preview-img" style="display: none;" />
</div>

            <br />
            <br /><br />
            <br />

            <h3 class="preview-heading">
              Extracted Financial Information: Statement of Profit & Loss
            </h3>
            <div id="plExtractedTableContainer" class="table-responsive my-3"></div>

            <button
              class="btn btn-warning edit-btn"
              onclick="toggleEdit('batelcoPLTable')"
            >
              Edit
            </button>
            <button
              class="btn btn-success edit-btn"
              onclick="saveTable('batelcoPLTable')"
            >
              Save
            </button>

            <div
              id="noteContainer-batelcoPLTable"
              style="display: none; margin-bottom: 10px"
            >
              <input
                type="text"
                id="noteInput-batelcoPLTable"
                class="form-control"
                placeholder="Enter note for audit log"
              />
            </div>


<!-- Batelco Profit & Loss Table -->
<div id="batelcoPL" style="display:none;">
  <table class="table table-bordered text-center" id="batelcoPLTable">
    <thead>
      <tr>
        <th>Description</th>
        <th>31 March 2024 BD'000</th>
        <th>31 March 2023 BD'000</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>REVENUE</td><td>110,459</td><td>103,544</td></tr>
      <tr><td>Network operating expenses</td><td>(40,555)</td><td>(35,231)</td></tr>
      <tr><td>Staff costs</td><td>(14,105)</td><td>(13,333)</td></tr>
      <tr><td>Depreciation, amortisation, impairment</td><td>(17,050)</td><td>(17,217)</td></tr>
      <tr><td>Impairment loss on receivables & contracts</td><td>(828)</td><td>(1,108)</td></tr>
      <tr><td>Other operating expenses</td><td>(10,888)</td><td>(11,158)</td></tr>
      <tr><td>Total expenses</td><td>(83,426)</td><td>(78,047)</td></tr>
      <tr><td>Results from operating activities</td><td>27,033</td><td>25,497</td></tr>
      <tr><td>Finance and related income</td><td>2,410</td><td>2,032</td></tr>
      <tr><td>Finance and related expenses</td><td>(6,731)</td><td>(5,566)</td></tr>
      <tr><td>Other income (net)</td><td>183</td><td>566</td></tr>
      <tr><td>Share of profit from equity investees</td><td>368</td><td>313</td></tr>
      <tr><td>Profit before taxation</td><td>23,263</td><td>22,842</td></tr>
      <tr><td>Income tax expense</td><td>(1,892)</td><td>(2,559)</td></tr>
      <tr><td>Profit for the period</td><td>21,371</td><td>20,283</td></tr>
      <tr><td>Total</td><td>21,371</td><td>20,283</td></tr>
      <tr><td>Other comprehensive income: - Foreign currency translation differences</td><td>(301)</td><td>1,108</td></tr>
      <tr><td>Other comprehensive income: - Investment fair value changes</td><td>21,203</td><td>1,608</td></tr>
      <tr><td>Other comprehensive income, net of tax</td><td>20,902</td><td>2,716</td></tr>
      <tr><td>Profit for the period</td><td>21,371</td><td>20,283</td></tr>
      <tr><td>Attributable to: - Equity holders of the Company</td><td>18,794</td><td>18,045</td></tr>
      <tr><td>Attributable to: - Non-controlling interest</td><td>2,577</td><td>2,238</td></tr>
      <tr><td>Total comprehensive income</td><td>42,273</td><td>22,999</td></tr>
      <tr><td>Attributable to: - Equity holders of the Company</td><td>39,696</td><td>20,761</td></tr>
      <tr><td>Attributable to: - Non-controlling interest</td><td>2,577</td><td>2,238</td></tr>
      <tr><td>Basic and Diluted earnings per share (Fils)</td><td>11.4</td><td>10.9</td></tr>
    </tbody>
  </table>
</div>


	<!-- Nike Profit & Loss Table -->
<div id="nikePL" style="display: none;">
  <table class="table table-bordered text-center">
    <thead>
      <tr>
        <th>Description</th>
        <th>2024 (AED’000)</th>
        <th>2023 (AED’000)</th>
        <th>2022 (AED’000)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Revenues</td><td>51,362</td><td>51,217</td><td>46,710</td></tr>
      <tr><td>Cost of sales</td><td>-28,475</td><td>-28,925</td><td>-25,231</td></tr>
      <tr><td>Gross profit</td><td>22,887</td><td>22,292</td><td>21,479</td></tr>
      <tr><td>Demand creation expense</td><td>-4,285</td><td>-4,060</td><td>-3,850</td></tr>
      <tr><td>Operating overhead expense</td><td>-12,291</td><td>-12,317</td><td>-10,954</td></tr>
      <tr><td>Total selling and administrative expense</td><td>-16,576</td><td>-16,377</td><td>-14,804</td></tr>
      <tr><td>Interest expense (income), net</td><td>161</td><td>6</td><td>-205</td></tr>
      <tr><td>Other (income) expense, net</td><td>-228</td><td>-280</td><td>-181</td></tr>
      <tr><td>Income before income taxes</td><td>6,700</td><td>6,201</td><td>6,651</td></tr>
      <tr><td>Income tax expense</td><td>-1,000</td><td>-1,131</td><td>-605</td></tr>
      <tr><td>Net income</td><td>5,700</td><td>5,070</td><td>6,046</td></tr>
      <tr><td>Earnings per common share (Basic)</td><td>3.76</td><td>3.27</td><td>3.83</td></tr>
      <tr><td>Earnings per common share (Diluted)</td><td>3.73</td><td>3.23</td><td>3.75</td></tr>
      <tr><td>Weighted average common shares outstanding (Basic)</td><td>1,517.6</td><td>1,551.6</td><td>1,578.8</td></tr>
      <tr><td>Weighted average common shares outstanding (Diluted)</td><td>1,529.7</td><td>1,569.8</td><td>1,610.8</td></tr>
    </tbody>
  </table>
</div>


            <table
              id="financialTable1"
              border="1"
              class="dataframe table table-bordered text-center data-table"
            >
              <thead>
                <tr style="text-align: right">
                  <th>Description</th>
                  <th>Six Months Ended June 30, 2024 (AED’000)</th>
                  <th>Six Months Ended June 30, 2023 (AED’000)</th>
                  <th>Three Months Ended June 30, 2024 (AED’000)</th>
                  <th>Three Months Ended June 30, 2023 (AED’000)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Revenue</td>
                  <td>1,558,650</td>
                  <td>1,754,361</td>
                  <td>777,024</td>
                  <td>871,983</td>
                </tr>
                <tr>
                  <td>Cost of sales</td>
                  <td>-943,844</td>
                  <td>-1,078,181</td>
                  <td>-469,680</td>
                  <td>-536,951</td>
                </tr>
                <tr>
                  <td>Gross profit</td>
                  <td>614,806</td>
                  <td>676,180</td>
                  <td>307,344</td>
                  <td>335,032</td>
                </tr>
                <tr>
                  <td>
                    Administrative and general expenses
                  </td>
                  <td>-117,228</td>
                  <td>-118,987</td>
                  <td>-59,490</td>
                  <td>-61,191</td>
                </tr>
                <tr>
                  <td>
                    Selling and distribution expenses
                  </td>
                  <td>-328,461</td>
                  <td>-362,023</td>
                  <td>-167,931</td>
                  <td>-181,631</td>
                </tr>
                <tr>
                  <td>Other income</td>
                  <td>36,753</td>
                  <td>36,166</td>
                  <td>17,403</td>
                  <td>21,127</td>
                </tr>
                <tr>
                  <td>Finance costs</td>
                  <td>-66,873</td>
                  <td>-60,374</td>
                  <td>-31,233</td>
                  <td>-32,478</td>
                </tr>
                <tr>
                  <td>Finance income</td>
                  <td>9,059</td>
                  <td>7,474</td>
                  <td>1,979</td>
                  <td>5,886</td>
                </tr>
                <tr>
                  <td>Loss on net monetary position</td>
                  <td>-1,841</td>
                  <td>-571</td>
                  <td>-946</td>
                  <td>119</td>
                </tr>
                <tr>
                  <td>
                    Share of (loss)/profit in equity accounted investees
                  </td>
                  <td>-125</td>
                  <td>443</td>
                  <td>-155</td>
                  <td>421</td>
                </tr>
                <tr>
                  <td>Impairment loss</td>
                  <td>-12,364</td>
                  <td>-13,126</td>
                  <td>-7,178</td>
                  <td>-7,202</td>
                </tr>
                <tr>
                  <td>Profit before tax</td>
                  <td>133,726</td>
                  <td>165,182</td>
                  <td>59,793</td>
                  <td>80,083</td>
                </tr>
                <tr>
                  <td>Tax expense</td>
                  <td>-19,808</td>
                  <td>-9,991</td>
                  <td>-8,775</td>
                  <td>-4,993</td>
                </tr>
                <tr>
                  <td>Profit for the period</td>
                  <td>113,918</td>
                  <td>155,191</td>
                  <td>51,018</td>
                  <td>75,090</td>
                </tr>
                <tr>
                  <td>
                    Profit attributable to Owners of the Company
                  </td>
                  <td>107,883</td>
                  <td>143,012</td>
                  <td>50,274</td>
                  <td>69,600</td>
                </tr>
                <tr>
                  <td>
                    Profit attributable to Non-controlling interests
                  </td>
                  <td>6,035</td>
                  <td>12,179</td>
                  <td>744</td>
                  <td>5,490</td>
                </tr>
                <tr>
                  <td>
                    Earnings per share - basic and diluted (AED)
                  </td>
                  <td>0.11</td>
                  <td>0.14</td>
                  <td>0.05</td>
                  <td>0.07</td>
                </tr>
              </tbody>
            </table>

            <br />
            <br />
            <br />
            <br />

            <h3 class="preview-heading">
              Extracted Financial Information: Statement of Financial Position
            </h3>
            <div id="bsExtractedTableContainer" class="table-responsive my-3"></div>

            <button
              class="btn btn-warning edit-btn"
              onclick="toggleEdit('batelcoBSTable')"
            >
              Edit
            </button>
            <button
              class="btn btn-success edit-btn"
              onclick="saveTable('batelcoBSTable')"
            >
              Save
            </button>
            <div
              id="noteContainer-batelcoBSTable"
              style="display: none; margin-bottom: 10px"
            >
              <input
                type="text"
                id="noteInput-batelcoBSTable"
                class="form-control"
                placeholder="Enter note for audit log"
              />
            </div>



<!-- Batelco Balance Sheet Table -->
<div id="batelcoBS" style="display:none;">
  <table class="table table-bordered text-center" id="batelcoBSTable">
    <thead>
      <tr>
        <th>Description</th>
        <th>31 March 2024 BD'000 (Reviewed)</th>
        <th>31 Dec 2023 BD'000 (Audited)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Property and equipment</td><td>365,058</td><td>366,838</td></tr>
      <tr><td>Right-of-use assets</td><td>55,239</td><td>55,606</td></tr>
      <tr><td>Goodwill</td><td>137,758</td><td>137,775</td></tr>
      <tr><td>Other intangible assets</td><td>159,577</td><td>162,461</td></tr>
      <tr><td>Equity accounted investees</td><td>8,922</td><td>8,541</td></tr>
      <tr><td>Deferred tax assets</td><td>6,474</td><td>6,375</td></tr>
      <tr><td>Investments</td><td>60,405</td><td>35,371</td></tr>
      <tr><td>Other non-current assets</td><td>11,462</td><td>6,706</td></tr>
      <tr><td>Total non-current assets</td><td>804,895</td><td>779,673</td></tr>
      <tr><td>Inventories</td><td>9,672</td><td>7,433</td></tr>
      <tr><td>Trade and other receivables</td><td>158,555</td><td>142,201</td></tr>
      <tr><td>Investments</td><td>19,451</td><td>291</td></tr>
      <tr><td>Cash and bank balances</td><td>208,499</td><td>235,767</td></tr>
      <tr><td>Total current assets</td><td>396,177</td><td>385,692</td></tr>
      <tr><td>Total assets</td><td>1,201,072</td><td>1,165,365</td></tr>
      <tr><td>Trade and other payables (non-current)</td><td>54,797</td><td>60,769</td></tr>
      <tr><td>Lease liabilities (non-current)</td><td>44,665</td><td>45,776</td></tr>
      <tr><td>Loans and borrowings (non-current)</td><td>73,053</td><td>244,198</td></tr>
      <tr><td>Deferred tax liabilities</td><td>5,634</td><td>5,729</td></tr>
      <tr><td>Total non-current liabilities</td><td>178,149</td><td>356,472</td></tr>
      <tr><td>Trade and other payables (current)</td><td>254,689</td><td>207,027</td></tr>
      <tr><td>Lease liabilities (current)</td><td>9,369</td><td>8,627</td></tr>
      <tr><td>Loans and borrowings (current)</td><td>179,904</td><td>10,696</td></tr>
      <tr><td>Total current liabilities</td><td>443,962</td><td>226,350</td></tr>
      <tr><td>Total liabilities</td><td>622,111</td><td>582,822</td></tr>
      <tr><td>Net assets</td><td>578,961</td><td>582,543</td></tr>
      <tr><td>Share capital</td><td>166,320</td><td>166,320</td></tr>
      <tr><td>Statutory reserve</td><td>88,856</td><td>86,188</td></tr>
      <tr><td>General reserve</td><td>44,000</td><td>44,000</td></tr>
      <tr><td>Other reserves</td><td>(7,217)</td><td>(28,173)</td></tr>
      <tr><td>Treasury shares</td><td>(4,573)</td><td>(4,428)</td></tr>
      <tr><td>Retained earnings</td><td>238,467</td><td>268,404</td></tr>
      <tr><td>Total equity attributable to equity holders</td><td>525,853</td><td>532,311</td></tr>
      <tr><td>Non-controlling interest</td><td>53,108</td><td>50,232</td></tr>
      <tr><td>Total equity</td><td>578,961</td><td>582,543</td></tr>
    </tbody>
  </table>
</div>


<div id="nikeBS" style="display: none;">
  <table class="table table-bordered text-center">
    <thead>
      <tr>
        <th>Description</th>
        <th>2024 (AED’000)</th>
        <th>2023 (AED’000)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td><strong>ASSETS</strong></td><td></td><td></td></tr>
      <tr><td><strong>Current assets:</strong></td><td></td><td></td></tr>
      <tr><td>Cash and equivalents</td><td>9,860</td><td>7,441</td></tr>
      <tr><td>Short-term investments</td><td>1,722</td><td>3,234</td></tr>
      <tr><td>Accounts receivable, net</td><td>4,427</td><td>4,131</td></tr>
      <tr><td>Inventories</td><td>7,519</td><td>8,454</td></tr>
      <tr><td>Prepaid expenses and other current assets</td><td>1,854</td><td>1,942</td></tr>
      <tr><td>Total current assets</td><td>25,382</td><td>25,202</td></tr>
      <tr><td>Property, plant and equipment, net</td><td>5,000</td><td>5,081</td></tr>
      <tr><td>Operating lease right-of-use assets, net</td><td>2,718</td><td>2,923</td></tr>
      <tr><td>Identifiable intangible assets, net</td><td>259</td><td>274</td></tr>
      <tr><td>Goodwill</td><td>240</td><td>281</td></tr>
      <tr><td>Deferred income taxes and other assets</td><td>4,511</td><td>3,770</td></tr>
      <tr><td><strong>TOTAL ASSETS</strong></td><td>38,110</td><td>37,531</td></tr>
      <tr><td><strong>LIABILITIES AND SHAREHOLDERS' EQUITY</strong></td><td></td><td></td></tr>
      <tr><td><strong>Current liabilities:</strong></td><td></td><td></td></tr>
      <tr><td>Current portion of long-term debt</td><td>1,000</td><td></td></tr>
      <tr><td>Notes payable</td><td>6</td><td>6</td></tr>
      <tr><td>Accounts payable</td><td>2,851</td><td>2,862</td></tr>
      <tr><td>Current portion of operating lease liabilities</td><td>477</td><td>425</td></tr>
      <tr><td>Accrued liabilities</td><td>5,725</td><td>5,723</td></tr>
      <tr><td>Income taxes payable</td><td>534</td><td>240</td></tr>
      <tr><td>Total current liabilities</td><td>10,593</td><td>9,256</td></tr>
      <tr><td>Long-term debt</td><td>7,903</td><td>8,927</td></tr>
      <tr><td>Operating lease liabilities</td><td>2,566</td><td>2,786</td></tr>
      <tr><td>Deferred income taxes and other liabilities</td><td>2,618</td><td>2,558</td></tr>
      <tr><td>Commitments and contingencies (Note 16)</td><td></td><td></td></tr>
      <tr><td>Redeemable preferred stock</td><td></td><td></td></tr>
      <tr><td><strong>Shareholders' equity:</strong></td><td></td><td></td></tr>
      <tr><td>Common stock at stated value:</td><td></td><td></td></tr>
      <tr><td>Class A convertible — 298 and 305 shares outstanding</td><td></td><td></td></tr>
      <tr><td>Class B — 1,205 and 1,227 shares outstanding</td><td>3</td><td>3</td></tr>
      <tr><td>Capital in excess of stated value</td><td>13,409</td><td>12,412</td></tr>
      <tr><td>Accumulated other comprehensive income (loss)</td><td>53</td><td>231</td></tr>
      <tr><td>Retained earnings (deficit)</td><td>965</td><td>1,358</td></tr>
      <tr><td>Total shareholders' equity</td><td>14,430</td><td>14,004</td></tr>
      <tr><td><strong>TOTAL LIABILITIES AND SHAREHOLDERS' EQUITY</strong></td><td>38,110</td><td>37,531</td></tr>
    </tbody>
  </table>
</div>


            <table
              id="financialTable2"
              border="1"
              class="dataframe table table-bordered text-center data-table"
            >
              <thead>
                <tr style="text-align: right">
                  <th>Description</th>
                  <th>30 June 2024 AED'000 (unaudited)</th>
                  <th>31 December 2023 AED'000 (audited)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Assets</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Non-current assets</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Property, plant and equipment</td>
                  <td>1,359,201</td>
                  <td>1,354,744</td>
                </tr>
                <tr>
                  <td>Goodwill</td>
                  <td>120,098</td>
                  <td>120,135</td>
                </tr>
                <tr>
                  <td>Right-of-use assets</td>
                  <td>88,228</td>
                  <td>87,632</td>
                </tr>
                <tr>
                  <td>Intangible assets</td>
                  <td>13,453</td>
                  <td>14,932</td>
                </tr>
                <tr>
                  <td>Investment properties</td>
                  <td>896,847</td>
                  <td>900,742</td>
                </tr>
                <tr>
                  <td>
                    Investments in equity accounted investees
                  </td>
                  <td>10,539</td>
                  <td>11,332</td>
                </tr>
                <tr>
                  <td>Long-term receivables</td>
                  <td>17,583</td>
                  <td>21,556</td>
                </tr>
                <tr>
                  <td>Derivative financial assets</td>
                  <td>2,937</td>
                  <td>4,277</td>
                </tr>
                <tr>
                  <td>Deferred tax assets</td>
                  <td>5,992</td>
                  <td>6,041</td>
                </tr>
                <tr>
                  <td>Total non-current assets</td>
                  <td>2,514,878</td>
                  <td>2,521,391</td>
                </tr>
                <tr>
                  <td>Current assets</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Inventories</td>
                  <td>1,316,726</td>
                  <td>1,301,903</td>
                </tr>
                <tr>
                  <td>Trade and other receivables</td>
                  <td>1,173,000</td>
                  <td>1,189,975</td>
                </tr>
                <tr>
                  <td>Due from related parties</td>
                  <td>49,245</td>
                  <td>55,734</td>
                </tr>
                <tr>
                  <td>Derivative financial assets</td>
                  <td>9,870</td>
                  <td>7,462</td>
                </tr>
                <tr>
                  <td>
                    Bank deposits with an original maturity of more than three
                    months
                  </td>
                  <td>14,667</td>
                  <td>41,381</td>
                </tr>
                <tr>
                  <td>Cash and cash equivalents</td>
                  <td>187,407</td>
                  <td>239,245</td>
                </tr>
                <tr>
                  <td>Total current assets</td>
                  <td>2,750,915</td>
                  <td>2,835,700</td>
                </tr>
                <tr>
                  <td>Total assets</td>
                  <td>5,265,793</td>
                  <td>5,357,091</td>
                </tr>
                <tr>
                  <td>Equity and liabilities</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Capital and reserves</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Share capital</td>
                  <td>993,703</td>
                  <td>993,703</td>
                </tr>
                <tr>
                  <td>Reserves</td>
                  <td>1,222,007</td>
                  <td>1,240,552</td>
                </tr>
                <tr>
                  <td>
                    Equity attributable to owners of the Company
                  </td>
                  <td>2,215,710</td>
                  <td>2,234,255</td>
                </tr>
                <tr>
                  <td>Non-controlling interests</td>
                  <td>92,594</td>
                  <td>134,495</td>
                </tr>
                <tr>
                  <td>Total equity</td>
                  <td>2,308,304</td>
                  <td>2,368,750</td>
                </tr>
                <tr>
                  <td>Non-current liabilities</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Islamic bank financing</td>
                  <td>242,523</td>
                  <td>296,674</td>
                </tr>
                <tr>
                  <td>
                    Interest bearing bank financing
                  </td>
                  <td>664,436</td>
                  <td>620,998</td>
                </tr>
                <tr>
                  <td>Due to related parties</td>
                  <td>2,159</td>
                  <td>2,163</td>
                </tr>
                <tr>
                  <td>
                    Provision for employees' end of service benefits
                  </td>
                  <td>116,899</td>
                  <td>118,453</td>
                </tr>
                <tr>
                  <td>Lease liabilities</td>
                  <td>71,529</td>
                  <td>67,804</td>
                </tr>
                <tr>
                  <td>Deferred tax liabilities</td>
                  <td>26,709</td>
                  <td>29,973</td>
                </tr>
                <tr>
                  <td>Total non-current liabilities</td>
                  <td>1,124,255</td>
                  <td>1,136,065</td>
                </tr>
                <tr>
                  <td>Current liabilities</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Islamic bank financing</td>
                  <td>298,263</td>
                  <td>317,399</td>
                </tr>
                <tr>
                  <td>
                    Interest bearing bank financing
                  </td>
                  <td>547,862</td>
                  <td>463,765</td>
                </tr>
                <tr>
                  <td>Trade and other payables</td>
                  <td>767,865</td>
                  <td>817,704</td>
                </tr>
                <tr>
                  <td>Due to related parties</td>
                  <td>16,656</td>
                  <td>44,939</td>
                </tr>
                <tr>
                  <td>
                    Derivative financial liabilities
                  </td>
                  <td>585</td>
                  <td>4,296</td>
                </tr>
                <tr>
                  <td>Lease liabilities</td>
                  <td>32,085</td>
                  <td>32,846</td>
                </tr>
                <tr>
                  <td>Provision for taxation</td>
                  <td>169,918</td>
                  <td>171,327</td>
                </tr>
                <tr>
                  <td>Total current liabilities</td>
                  <td>1,833,234</td>
                  <td>1,852,276</td>
                </tr>
                <tr>
                  <td>Total liabilities</td>
                  <td>2,957,489</td>
                  <td>2,988,341</td>
                </tr>
                <tr>
                  <td>Total equity and liabilities</td>
                  <td>5,265,793</td>
                  <td>5,357,091</td>
                </tr>
              </tbody>
            </table>

            <br />
            <br /><br />
            <br />

            <h3 class="preview-heading">
              Financial Ratios for Loan Decisioning
            </h3>
            <table id="ratios" class="table table-bordered text-center mt-3">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                  <th>Calculation</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Short Term Liab./Total Assets</td>
                  <td>0.3482</td>
                  <td>
                    (Total Current Liabilities / Total Assets) <br />
                    (1,833,234 / 5,265,793)
                  </td>
                </tr>
                <tr>
                  <td>Net Profit Margin</td>
                  <td>0.0731</td>
                  <td>
                    (Profit for the Period / Revenue) <br />
                    (113,918 / 1,558,650)
                  </td>
                </tr>
                <tr>
                  <td>Equity / Total Liabilities (t-1)</td>
                  <td>0.7724</td>
                  <td>
                    (Total Equity / Total Liabilities) <br />
                    (2,308,304 / 2,988,341)
                  </td>
                </tr>
                <tr>
                  <td>Inventories / Current Assets</td>
                  <td>0.4787</td>
                  <td>
                    (Inventories / Total Current Assets) <br />
                    (1,316,726 / 2,750,915)
                  </td>
                </tr>
                <tr>
                  <td>Cash Ratio</td>
                  <td>0.1022</td>
                  <td>
                    (Cash and Cash Equivalents / Total Current Liabilities)
                    <br />
                    (187,407 / 1,833,234)
                  </td>
                </tr>
                <tr>
                  <td>EBIT / Net Sales</td>
                  <td>0.0858</td>
                  <td>
                    (Profit Before Tax / Revenue) <br />
                    (133,726 / 1,558,650)
                  </td>
                </tr>
              </tbody>
            </table>

            <br />

          <h3 class="preview-heading">Financial Health (2023 vs 2024)</h3>
<table id="financialHealth" class="table table-bordered text-center mt-3">
  <thead>
    <tr>
      <th>Metric</th>
      <th>2024 Value</th>
      <th>2023 Value</th>
      <th>Difference %</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>


<canvas id="financialHealthChart" width="800" height="400" style="margin-top: 40px;"></canvas>

<br>
<br>



            <h3 id="scoreHeading">
  Financial Module Score: <span id="scoreValue"></span> / 100
</h3>
<h3 id="riskCategoryHeading" class="text-warning">
  Risk Category: <span id="riskValue"></span>
</h3>


<br>
<br>

<div id ="authorityWarningContainer" class="alert alert-info mt-3 d-flex align-items-center justify-content-between" style="display: none;">
  <div id="decisionRuleResult">
    <strong>Authority Check:</strong> You are RESTRICTED from issuing a decision on this loan. Please escalate to Senior Credit Manager.
  </div>
  <div style="position: relative;">
    <span id="scorecardIcon"
      tabindex="0"
      class="ms-2 text-primary"
      data-bs-toggle="popover"
      data-bs-html="true"
      data-bs-trigger="hover"
      data-bs-placement="right"
      data-bs-content="">
  &#9432;
</span>


  </div>
</div>


<div class="container mt-4">
  <div class="row mb-3">

      <div class="row mb-3">
  <label class="col-sm-4 col-form-label"><strong>Your Name and Role:</strong></label>
  <div class="col-sm-8">
    <input type="text" class="form-control" value="Saman Khan (  Junior Credit Underwriter )" readonly />
  </div>
</div>

    <label class="col-sm-4 col-form-label"><strong>Reason for Approval or Rejection:</strong></label>
    <div class="col-sm-8">
      <input type="text" id="justificationInput" class="form-control" placeholder="Enter justification..." />

    </div>
  </div>
  <div class="row mb-3">
    <label class="col-sm-4 col-form-label"><strong>Approved Loan Amount:</strong></label>
    <div class="col-sm-8">
      <input type="text" id="approvedAmountInput" class="form-control" value="AED 50,000" />

    </div>
  </div>
  <div class="row mb-3">
    <label class="col-sm-4 col-form-label"><strong>Additional Terms:</strong></label>
    <div class="col-sm-8">
      <input type="text" id="termsInput" class="form-control" placeholder="Optional conditions or remarks..." />

    </div>
  </div>
</div>


           <div class="mt-3" id="buttonContainer">
  <!-- Buttons will be added by JS -->
</div>

          </div>
        </div>

        <div id="tab-audit" class="tab-content" style="display: none">
          <br />
          <br />
      <h4 class="mt-5">Data Modification Log</h4>
          <table class="table table-bordered text-center mt-3">
            <thead>
              <tr>
                <th>Date Time</th>
                <th>Changed By</th>
                <th>Value</th>
                <th>Before</th>
                <th>After</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-04-24 13:00</td>
                <td>Admin</td>
                <td>Revenue</td>
                <td>1,200,000</td>
                <td>1,558,650</td>
                <td>Manual correction</td>
              </tr>
            </tbody>
          </table>

      
      <h4 class="mt-5">Loan Decision</h4>
<table id="loanDecisionTable" class="table table-bordered text-center mt-3">
  <thead>
    <tr>
      <th>Date Time</th>
      <th>User</th>
      <th>Status</th>
      <th>Justification</th>
      <th>Approved Amount</th>
      <th>Additional Terms</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

      






        </div>

        <div id="tab-chatbot" class="tab-content" style="display: none">
          <iframe
            src="https://www.chatbase.co/chatbot-iframe/xGsCmoCAOJE7IeGEXKnya"
            width="100%"
            style="height: 90%; min-height: 550px"
            frameborder="0"
          ></iframe>
        </div>
      </div>
    </div>

    <script>



const AZURE_ENDPOINT = "https://lendingdemo1.cognitiveservices.azure.com/";
const AZURE_KEY = "CjKVbMGtY8AFu8UqgSm59MtUCbPyszL6uDr84dGEFmdZE0i1ODYZJQQJ99ALACYeBjFXJ3w3AAALACOG4jD7";

async function extractTableFromAzure(file) {
    const url = `${AZURE_ENDPOINT}formrecognizer/documentModels/prebuilt-layout:analyze?api-version=2023-07-31`;
    const response = await fetch(url, {
        method: "POST",
        headers: { "Ocp-Apim-Subscription-Key": AZURE_KEY, "Content-Type": "application/pdf" },
        body: file
    });

    if (!response.ok) throw new Error("Failed to send to Azure");
    const resultUrl = response.headers.get("operation-location");

    // Poll for result
    let result;
    do {
        await new Promise(r => setTimeout(r, 2000));
        const res = await fetch(resultUrl, { headers: { "Ocp-Apim-Subscription-Key": AZURE_KEY } });
        result = await res.json();
    } while (result.status === "running" || result.status === "notStarted");

    return result;
}

function convertAzureTablesToHTML(analysisResult) {
    let html = "<table class='table table-bordered text-center'>";  // ✅ ensure starts with table

    analysisResult?.analyzeResult?.tables?.forEach(table => {
        const maxCols = Math.max(...table.cells.map(c => c.columnIndex)) + 1;

        html += "<thead><tr>";
        for (let c = 0; c < maxCols; c++) html += `<th>Column ${c + 1}</th>`;
        html += "</tr></thead><tbody>";

        const maxRows = Math.max(...table.cells.map(c => c.rowIndex));
        for (let r = 0; r <= maxRows; r++) {
            html += "<tr>";
            for (let c = 0; c < maxCols; c++) {
                const cell = table.cells.find(cc => cc.rowIndex === r && cc.columnIndex === c);
                html += `<td>${cell ? cell.content : ""}</td>`;
            }
            html += "</tr>";
        }
        html += "</tbody>";
    });

    html += "</table>"; // ✅ close table properly
    return html;
}

const ALT_NAMES = {
    revenue: ["revenue", "revenues", "net sales", "sales", "turnover"],
    profitForPeriod: ["profit for the period", "net income", "net earnings", "profit attributable", "earnings"],
    profitBeforeTax: ["profit before tax", "profit before taxation", "income before income tax", "ebit"],
    totalAssets: ["total assets"],
    totalEquity: ["total equity"], // ✅ removed equity attributable to avoid mismatch
    totalLiabilities: ["total liabilities"],
    totalCurrentLiabilities: ["total current liabilities"], // ✅ avoid partial match with non-current
    totalCurrentAssets: ["total current assets"], // ✅ added for inventories ratio
    inventories: ["inventories", "inventory", "stock"],
    cashAndCash: ["cash and cash equivalents", "cash equivalents", "cash and bank balances"]
};



function getValueFromTable(containerId, altNames) {
    const container = document.getElementById(containerId);
    if (!container) return 0;

    const rows = container.querySelectorAll("table tr");
    for (let row of rows) {
        const cells = Array.from(row.cells);
        if (cells.length < 3) continue;

        const rowText = cells[0].innerText.toLowerCase().trim();
        if (altNames.some(name => rowText.startsWith(name))) { // ✅ strict startsWith
            const clean = cells[2].innerText.replace(/[^0-9.-]/g, "");
            const num = parseFloat(clean);
            if (!isNaN(num)) return num;
        }
    }
    return 0;
}










function updateRatiosFromExtractedTables() {
    const revenue = getValueFromTable("plExtractedTableContainer", ALT_NAMES.revenue);
    const profitForPeriod = getValueFromTable("plExtractedTableContainer", ALT_NAMES.profitForPeriod);
    const profitBeforeTax = getValueFromTable("plExtractedTableContainer", ALT_NAMES.profitBeforeTax);

    const totalAssets = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.totalAssets);
    const totalEquity = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.totalEquity);
    const totalLiabilities = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.totalLiabilities);
    const totalCurrentLiabilities = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.totalCurrentLiabilities);
    const inventories = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.inventories);
    const cash = getValueFromTable("bsExtractedTableContainer", ALT_NAMES.cashAndCash);

    const ratios = [
        {
            metric: "Short Term Liab./Total Assets",
            value: (totalCurrentLiabilities / totalAssets).toFixed(4),
            calc: `Total Current Liabilities / Total Assets (${totalCurrentLiabilities.toLocaleString()} / ${totalAssets.toLocaleString()})`
        },
        {
            metric: "Net Profit Margin",
            value: (profitForPeriod / revenue).toFixed(4),
            calc: `Profit for the Period / Revenue (${profitForPeriod.toLocaleString()} / ${revenue.toLocaleString()})`
        },
        {
            metric: "Equity / Total Liabilities (t-1)",
            value: (totalEquity / totalLiabilities).toFixed(4),
            calc: `Total Equity / Total Liabilities (${totalEquity.toLocaleString()} / ${totalLiabilities.toLocaleString()})`
        },
        {
    metric: "Inventories / Current Assets",
    value: (inventories / totalCurrentAssets).toFixed(4),
    calc: `Inventories / Total Current Assets (${inventories.toLocaleString()} / ${totalCurrentAssets.toLocaleString()})`
}
,
        {
            metric: "Cash Ratio",
            value: (cash / totalCurrentLiabilities).toFixed(4),
            calc: `Cash and Cash Equivalents / Total Current Liabilities (${cash.toLocaleString()} / ${totalCurrentLiabilities.toLocaleString()})`
        },
        {
            metric: "EBIT / Net Sales",
            value: (profitBeforeTax / revenue).toFixed(4),
            calc: `Profit Before Tax / Revenue (${profitBeforeTax.toLocaleString()} / ${revenue.toLocaleString()})`
        }
    ];

    const tbody = document.querySelector("#ratios tbody");
    tbody.innerHTML = "";
    ratios.forEach(r => {
        tbody.innerHTML += `<tr><td>${r.metric}</td><td>${r.value}</td><td>${r.calc}</td></tr>`;
    });
}





      let editHistory = {};

      function toggleEdit(tableId) {
  let table = document.getElementById(tableId);
  let rows = table.querySelectorAll("tbody tr");
  const isEditing = rows[0].cells[1].isContentEditable; // Check first data cell

  for (let row of rows) {
    // Skip the first column (the description)
    for (let i = 1; i < row.cells.length; i++) {
      row.cells[i].contentEditable = isEditing ? "false" : "true";
      // Optional: add style to show it's editable
      if (!isEditing) row.cells[i].style.backgroundColor = "#f9fbe7";
      else row.cells[i].style.backgroundColor = "";
    }
  }

  // Show/hide note field
  document.getElementById(`noteContainer-${tableId}`).style.display = isEditing
    ? "none"
    : "block";

  // Store original values for audit if entering edit mode
  if (!isEditing) {
    editHistory[tableId] = [];
    rows.forEach((row, rowIndex) => {
      for (let colIndex = 1; colIndex < row.cells.length; colIndex++) {
        editHistory[tableId].push({
          rowIndex,
          colIndex,
          value: row.cells[colIndex].innerText,
        });
      }
    });
  }
}


      function saveTable(tableId) {
        let table = document.getElementById(tableId);
        let cells = table.querySelectorAll("td[contenteditable]");
        let data = [];
        cells.forEach((cell) => {
          data.push(cell.innerText);
          cell.contentEditable = "false";
        });
        console.log("Saved Data:", data);
        alert("Table data saved!");

        // 🔄 Refresh ratios after saving table
        //updateRatiosFromTables();

        // 🎨 Recolor the ratios table
        setTimeout(() => colorRatioRowsAccurately(), 100); // slight delay ensures DOM is ready

        updateFinancialModuleScore();

        let auditTable = document.querySelector("#tab-audit tbody");
        let rows = document.querySelectorAll(`#${tableId} tbody tr`);
        let note = document.getElementById(`noteInput-${tableId}`).value;
        let now = new Date().toISOString().slice(0, 19).replace("T", " ");

        editHistory[tableId]?.forEach((edit) => {
          let row = rows[edit.rowIndex];
          let desc = row.cells[0].innerText;
          let before = edit.value;
          let after = row.cells[edit.colIndex].innerText;

          if (before !== after) {
            let newRow = document.createElement("tr");
            newRow.innerHTML = `
      <td>${now}</td>
      <td>Saman Khan</td>
      <td>${desc}</td>
      <td>${before}</td>
      <td>${after}</td>
      <td>${note}</td>
    `;
            auditTable.appendChild(newRow);
          }
        });

        document.getElementById(`noteContainer-${tableId}`).style.display =
          "none";
        document.getElementById(`noteInput-${tableId}`).value = "";
      }

      document.getElementById("loanForm").addEventListener("submit", async (event) => {
    event.preventDefault();

    const profitFile = document.getElementById("profitLoss").files[0];
    const positionFile = document.getElementById("financialPosition").files[0];
    if (!profitFile || !positionFile) {
        alert("Please upload both files.");
        return;
    }

    document.getElementById("loading").style.display = "block";
    document.getElementById("result").style.display = "none";

    try {
        // ✅ Extract P&L
        const plResult = await extractTableFromAzure(profitFile);
        const plHTML = convertAzureTablesToHTML(plResult);
        document.getElementById("plExtractedTableContainer").innerHTML = plHTML;

        // ✅ Extract Balance Sheet
        const bsResult = await extractTableFromAzure(positionFile);
        const bsHTML = convertAzureTablesToHTML(bsResult);
        document.getElementById("bsExtractedTableContainer").innerHTML = bsHTML;


        // ✅ Hide static hardcoded tables after extraction
document.getElementById("batelcoPL").style.display = "none";
document.getElementById("batelcoBS").style.display = "none";
document.getElementById("nikePL").style.display = "none";
document.getElementById("nikeBS").style.display = "none";

        // ✅ Show results and calculate ratios only now
        document.getElementById("loading").style.display = "none";
        document.getElementById("result").style.display = "block";

        // ✅ Trigger ratios calculation only after both tables are ready
        updateRatiosFromExtractedTables();

    } catch (err) {
        alert("Error extracting tables: " + err.message);
        document.getElementById("loading").style.display = "none";
    }
});



      function colorRatioRowsAccurately() {
        const ratioTable = document.getElementById("ratios");
        if (!ratioTable) return;

        const rows = ratioTable.querySelectorAll("tbody tr");

        rows.forEach((row) => {
          const cells = row.querySelectorAll("td");
          const metric = cells[0]?.innerText.trim();
          const value = parseFloat(cells[1]?.innerText.trim());
          let colorClass = "";

          if (!metric || isNaN(value)) return;

          if (metric === "Short Term Liab./Total Assets") {
            if (value < 0.4) colorClass = "bg-green";
            else if (value < 0.64) colorClass = "bg-yellow";
            else colorClass = "bg-red";
          } else if (metric === "Net Profit Margin") {
            if (value > 0.1) colorClass = "bg-green";
            else if (value > 0.05) colorClass = "bg-yellow";
            else colorClass = "bg-red";
          } else if (metric === "Equity / Total Liabilities (t-1)") {
            if (value > 0.25) colorClass = "bg-green";
            else if (value > 0.05) colorClass = "bg-yellow";
            else colorClass = "bg-red";
          } else if (metric === "Inventories / Current Assets") {
            if (value > 0.15) colorClass = "bg-green";
            else if (value > 0.07) colorClass = "bg-yellow";
            else colorClass = "bg-red";
          } else if (metric === "Cash Ratio") {
            if (value > 0.15) colorClass = "bg-green";
            else colorClass = "bg-red";
          } else if (metric === "EBIT / Net Sales") {
            if (value > 0.1) colorClass = "bg-green";
            else colorClass = "bg-red";
          }

          if (colorClass) {
            row.classList.add(colorClass);
          }
        });
      }

      // Trigger when result section is visible
      const resultObserver = new MutationObserver(() => {
        const result = document.getElementById("result");
        if (result.style.display === "block") {
          // Show the tab switcher at the top
          document.getElementById("tabSwitcher").style.display = "flex";

          // Apply row coloring
          setTimeout(() => colorRatioRowsAccurately(), 200);

          // Disconnect observer
          resultObserver.disconnect();
        }
      });

      resultObserver.observe(document.getElementById("result"), {
        attributes: true,
        attributeFilter: ["style"],
      });

      function switchTab(tabId, element) {
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.style.display = "none";
        });
        document.getElementById(tabId).style.display = "block";

        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("active");
        });
        element.classList.add("active");
      }

function updateRatiosFromTables() {
  const isNike = document.getElementById("nikePL").style.display === "block";
  const isBatelco = document.getElementById("batelcoPL").style.display === "block";

  // Helper: get number from specified table/row/col
  function getBatelcoValue(tableId, rowLabel, colIdx) {
    const rows = document.querySelectorAll(`#${tableId} tbody tr`);
    for (let row of rows) {
      const label = row.cells[0]?.innerText.trim().toLowerCase();
      if (label === rowLabel.toLowerCase()) {
        // Remove any brackets and commas
        return parseFloat(row.cells[colIdx]?.innerText.replace(/[(),']/g, '').replace(/,/g, "")) || 0;
      }
    }
    return 0;
  }
  // Helper for existing tables (RAK)
  function getValue(tableId, rowLabel) {
    const tableSelector = isNike
      ? tableId === "financialTable1"
        ? "#nikePL"
        : "#nikeBS"
      : `#${tableId}`;
    const rows = document.querySelectorAll(`${tableSelector} tbody tr`);
    for (let row of rows) {
      const label = row.cells[0]?.innerText.trim().toLowerCase();
      if (label === rowLabel.toLowerCase()) {
        return parseFloat(row.cells[1]?.innerText.replace(/,/g, "")) || 0;
      }
    }
    return 0;
  }

  // ==== SETUP: What columns to use ====
  // Batelco: col 1 = 2024, col 2 = 2023
  const batelco2024 = 1, batelco2023 = 2;

  // Table definitions for each case
  const ratios = [
    {
      metric: "Short Term Liab./Total Assets",
      batelco: {
        num: () => getBatelcoValue("batelcoBS", "Total current liabilities", batelco2024),
        denom: () => getBatelcoValue("batelcoBS", "Total assets", batelco2024),
        formula: "(Total current liabilities / Total assets)"
      },
      default: {
        numLabel: "Total current liabilities",
        denomLabel: "Total assets",
        tableId: "financialTable2",
        formula: "(Total current liabilities / Total assets)"
      }
    },
    {
      metric: "Net Profit Margin",
      batelco: {
        num: () => getBatelcoValue("batelcoPL", "Profit for the period", batelco2024),
        denom: () => getBatelcoValue("batelcoPL", "REVENUE", batelco2024),
        formula: "(Profit for the period / Revenue)"
      },
      default: {
        numLabel: isNike ? "Net income" : "Profit for the period",
        denomLabel: isNike ? "Revenues" : "Revenue",
        tableId: "financialTable1",
        formula: isNike
          ? "(Net income / Revenues)"
          : "(Profit for the period / Revenue)"
      }
    },
    {
      metric: "Equity / Total Liabilities (t-1)",
      batelco: {
        num: () => getBatelcoValue("batelcoBS", "Total equity", batelco2024),
        denom: () => getBatelcoValue("batelcoBS", "Total liabilities", batelco2024),
        formula: "(Total equity / Total liabilities)"
      },
      default: {
        numLabel: isNike
          ? "Total shareholders' equity"
          : "Total equity",
        denomLabel: "Total liabilities",
        tableId: "financialTable2",
        formula: "(Equity / Total liabilities)"
      }
    },
    {
      metric: "Inventories / Current Assets",
      batelco: {
        num: () => getBatelcoValue("batelcoBS", "Inventories", batelco2024),
        denom: () => getBatelcoValue("batelcoBS", "Total current assets", batelco2024),
        formula: "(Inventories / Total current assets)"
      },
      default: {
        numLabel: "Inventories",
        denomLabel: "Total current assets",
        tableId: "financialTable2",
        formula: "(Inventories / Total current assets)"
      }
    },
    {
      metric: "Cash Ratio",
      batelco: {
        num: () => getBatelcoValue("batelcoBS", "Cash and bank balances", batelco2024),
        denom: () => getBatelcoValue("batelcoBS", "Total current liabilities", batelco2024),
        formula: "(Cash and bank balances / Total current liabilities)"
      },
      default: {
        numLabel: isNike ? "Cash and equivalents" : "Cash and cash equivalents",
        denomLabel: "Total current liabilities",
        tableId: "financialTable2",
        formula: "(Cash / Current liabilities)"
      }
    },
    {
      metric: "EBIT / Net Sales",
      batelco: {
        num: () => getBatelcoValue("batelcoPL", "Profit before taxation", batelco2024),
        denom: () => getBatelcoValue("batelcoPL", "REVENUE", batelco2024),
        formula: "(Profit before taxation / Revenue)"
      },
      default: {
        numLabel: isNike
          ? "Income before income taxes"
          : "Profit before tax",
        denomLabel: isNike ? "Revenues" : "Revenue",
        tableId: "financialTable1",
        formula: "(EBIT / Revenue)"
      }
    }
  ];

  // ===== Update the Ratio Table
  const ratioTable = document.querySelector("#ratios tbody");
  ratioTable.innerHTML = "";

  ratios.forEach((r) => {
    let numerator, denominator, value, calcText;
    if (isBatelco) {
      numerator = r.batelco.num();
      denominator = r.batelco.denom();
      value = denominator !== 0 ? (numerator / denominator).toFixed(4) : "N/A";
      calcText = `${r.batelco.formula}<br>(${numerator.toLocaleString()} / ${denominator.toLocaleString()})`;
    } else {
      numerator = getValue(r.default.tableId, r.default.numLabel);
      denominator = getValue(r.default.tableId, r.default.denomLabel);
      // Handle Nike-specific case for Total Liabilities (not directly available)
      if (r.metric === "Equity / Total Liabilities (t-1)" && isNike) {
        const totalAssets = getValue("financialTable2", "Total assets");
        const totalEquity = getValue("financialTable2", "Total shareholders' equity");
        denominator = totalAssets - totalEquity;
      }
      value = denominator !== 0 ? (numerator / denominator).toFixed(4) : "N/A";
      calcText = `${r.default.formula}<br>(${numerator.toLocaleString()} / ${denominator.toLocaleString()})`;
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${r.metric}</td>
      <td>${value}</td>
      <td>${calcText}</td>
    `;
    ratioTable.appendChild(row);
  });

  // ... (rest of your function stays the same)
  populateFinancialHealthTable();
  document.querySelectorAll("#financialHealth tbody tr").forEach((row) => {
    row.addEventListener("click", () => {
      const metric = row.cells[0].innerText.trim();
      renderFinancialHealthChart(metric);
    });
  });
  updateFinancialModuleScore();
}


    function updateFinancialModuleScore() {
  const isNike = document.getElementById("nikePL").style.display === "block";
  const isBatelco = document.getElementById("batelcoPL").style.display === "block";

  // Helper to fetch Batelco 2024 values
  function getBatelcoValue(tableId, rowLabel, colIdx) {
    const rows = document.querySelectorAll(`#${tableId} tbody tr`);
    for (let row of rows) {
      const label = row.cells[0]?.innerText.trim().toLowerCase();
      if (label === rowLabel.toLowerCase()) {
        return parseFloat(row.cells[colIdx]?.innerText.replace(/[(),']/g, '').replace(/,/g, "")) || 0;
      }
    }
    return 0;
  }

  // Helper for default and Nike
  function getValue(tableId, rowLabel, yearCol) {
    const tableSelector = isNike
      ? tableId === "financialTable1"
        ? "#nikePL"
        : "#nikeBS"
      : `#${tableId}`;
    const rows = document.querySelectorAll(`${tableSelector} tbody tr`);
    for (let row of rows) {
      const label = row.cells[0]?.innerText.trim().toLowerCase();
      if (label === rowLabel.toLowerCase()) {
        return parseFloat(row.cells[yearCol]?.innerText.replace(/,/g, "")) || 0;
      }
    }
    return 0;
  }

  // Prepare ratios (using only 2024 values)
  let ratioValues = [];

  if (isBatelco) {
    // Batelco, always column 2 (2024)
    const idx2024 = 1;
    ratioValues = [
      // Short Term Liab./Total Assets
      (() => {
        const num = getBatelcoValue("batelcoBS", "Total current liabilities", idx2024);
        const denom = getBatelcoValue("batelcoBS", "Total assets", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })(),
      // Net Profit Margin
      (() => {
        const num = getBatelcoValue("batelcoPL", "Profit for the period", idx2024);
        const denom = getBatelcoValue("batelcoPL", "REVENUE", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })(),
      // Equity / Total Liabilities
      (() => {
        const num = getBatelcoValue("batelcoBS", "Total equity", idx2024);
        const denom = getBatelcoValue("batelcoBS", "Total liabilities", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })(),
      // Inventories / Current Assets
      (() => {
        const num = getBatelcoValue("batelcoBS", "Inventories", idx2024);
        const denom = getBatelcoValue("batelcoBS", "Total current assets", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })(),
      // Cash Ratio
      (() => {
        const num = getBatelcoValue("batelcoBS", "Cash and bank balances", idx2024);
        const denom = getBatelcoValue("batelcoBS", "Total current liabilities", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })(),
      // EBIT / Net Sales
      (() => {
        const num = getBatelcoValue("batelcoPL", "Profit before taxation", idx2024);
        const denom = getBatelcoValue("batelcoPL", "REVENUE", idx2024);
        return denom !== 0 ? num / denom : NaN;
      })()
    ];
  } else if (isNike) {
    // Nike, column 2 = 2024
    ratioValues = [
      (() => {
        const num = getValue("financialTable2", "Total current liabilities", 1);
        const denom = getValue("financialTable2", "Total assets", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable1", "Net income", 1);
        const denom = getValue("financialTable1", "Revenues", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const equity = getValue("financialTable2", "Total shareholders' equity", 1);
        const assets = getValue("financialTable2", "Total assets", 1);
        const liab = assets - equity;
        return liab !== 0 ? equity / liab : NaN;
      })(),
      (() => {
        const num = getValue("financialTable2", "Inventories", 1);
        const denom = getValue("financialTable2", "Total current assets", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable2", "Cash and equivalents", 1);
        const denom = getValue("financialTable2", "Total current liabilities", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable1", "Income before income taxes", 1);
        const denom = getValue("financialTable1", "Revenues", 1);
        return denom !== 0 ? num / denom : NaN;
      })()
    ];
  } else {
    // Default: RAK Ceramics (column 2 = 2024)
    ratioValues = [
      (() => {
        const num = getValue("financialTable2", "Total current liabilities", 1);
        const denom = getValue("financialTable2", "Total assets", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable1", "Profit for the period", 1);
        const denom = getValue("financialTable1", "Revenue", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable2", "Total equity", 1);
        const denom = getValue("financialTable2", "Total liabilities", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable2", "Inventories", 1);
        const denom = getValue("financialTable2", "Total current assets", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable2", "Cash and cash equivalents", 1);
        const denom = getValue("financialTable2", "Total current liabilities", 1);
        return denom !== 0 ? num / denom : NaN;
      })(),
      (() => {
        const num = getValue("financialTable1", "Profit before tax", 1);
        const denom = getValue("financialTable1", "Revenue", 1);
        return denom !== 0 ? num / denom : NaN;
      })()
    ];
  }

  // --- Score calculation ---
  let score = 0;
  let count = 0;
  ratioValues.forEach((v, i) => {
    if (isNaN(v)) return; // skip missing ratios
    count += 1;
    // Use your own scoring thresholds
    switch (i) {
      // Short Term Liab./Total Assets
      case 0:
        if (v < 0.4) score += 15;
        else if (v < 0.64) score += 10;
        else score += 5;
        break;
      // Net Profit Margin
      case 1:
        if (v > 0.1) score += 15;
        else if (v > 0.05) score += 10;
        else score += 5;
        break;
      // Equity / Total Liabilities
      case 2:
        if (v > 0.25) score += 15;
        else if (v > 0.05) score += 10;
        else score += 5;
        break;
      // Inventories / Current Assets
      case 3:
        if (v > 0.15) score += 15;
        else if (v > 0.07) score += 10;
        else score += 5;
        break;
      // Cash Ratio
      case 4:
        if (v > 0.15) score += 15;
        else score += 5;
        break;
      // EBIT / Net Sales
      case 5:
        if (v > 0.1) score += 15;
        else score += 5;
        break;
    }
  });

  const maxScore = count * 15;
  const finalScore = count > 0 ? Math.round((score / maxScore) * 100) : "N/A";

  // --- Risk Category
  let category = "Class 1 (Low Risk)";
  if (finalScore === "N/A") category = "N/A";
  else if (finalScore < 30) category = "Class 5 (Very High Risk)";
  else if (finalScore < 50) category = "Class 4 (High Risk)";
  else if (finalScore < 70) category = "Class 3 (Moderate Risk)";
  else if (finalScore < 85) category = "Class 2 (Mild Risk)";

  // --- Display
  document.getElementById("scoreValue").innerText = finalScore;
  document.getElementById("riskValue").innerText = category;
}





function recordLoanDecision(status) {
  const justification = document.getElementById("justificationInput").value;
  const approvedAmount = document.getElementById("approvedAmountInput").value;
  const terms = document.getElementById("termsInput").value;

  const now = new Date().toISOString().slice(0, 19).replace("T", " ");
  const table = document.querySelector("#loanDecisionTable tbody");

  const newRow = document.createElement("tr");
  newRow.innerHTML = `
    <td>${now}</td>
    <td>Saman Khan</td>
    <td>${status}</td>
    <td>${justification}</td>
    <td>${approvedAmount}</td>
    <td>${terms}</td>
  `;
  table.appendChild(newRow);

  // Also add to All Requests table
  const allTable = document.querySelector("#allRequestsTable tbody");
  const newId = allTable.rows.length + 1;
  const newReqRow = document.createElement("tr");
  newReqRow.innerHTML = `<td>${newId}</td><td>Batelco B.S.C.</td><td>${status}</td>`;
  allTable.appendChild(newReqRow);

  alert(`Loan decision "${status}" recorded successfully.`);
}







function validateUploadedFile(fileInput) {
  const file = fileInput.files[0];
  const errorContainer = document.getElementById("uploadError");

  if (file && file.name === "RAKCeramics_ChangesInEquity.pdf") {
    errorContainer.innerText = "Couldn't find the required data in the uploaded document. Please try again.";
    errorContainer.style.display = "block";
    fileInput.value = ""; // clear the file
  } else {
    errorContainer.innerText = "";
    errorContainer.style.display = "none";
  }
}

document.getElementById("profitLoss").addEventListener("change", function () {
  validateUploadedFile(this);
});

document.getElementById("financialPosition").addEventListener("change", function () {
  validateUploadedFile(this);
});


function switchLeftTab(tabName) {
  document.getElementById("newRequest").style.display = tabName === "newRequest" ? "block" : "none";
  document.getElementById("allRequests").style.display = tabName === "allRequests" ? "block" : "none";

  document.getElementById("tabNew").classList.toggle("active", tabName === "newRequest");
  document.getElementById("tabAll").classList.toggle("active", tabName === "allRequests");
}


function populateFinancialHealthTable() {
    const isNike = document.getElementById("nikePL").style.display === "block";
    const isBatelco = document.getElementById("batelcoPL").style.display === "block";

    // ✅ Extract 2024 values directly from the ratios table
    const ratioRows = document.querySelectorAll("#ratios tbody tr");
    const ratioMap2024 = {};
    ratioRows.forEach(row => {
        const metric = row.cells[0].innerText.trim();
        const value = parseFloat(row.cells[1].innerText.trim());
        if (!isNaN(value)) ratioMap2024[metric] = value;
    });

    const healthTable = document.querySelector("#financialHealth tbody");
    healthTable.innerHTML = "";

    // ✅ Define metrics mapping to link with ratio names
    const metrics = [
        { name: "Short Term Liab./Total Assets", key: "Short Term Liab./Total Assets" },
        { name: "Net Profit Margin", key: "Net Profit Margin" },
        { name: "Equity / Total Liabilities (t-1)", key: "Equity / Total Liabilities (t-1)" },
        { name: "Inventories / Current Assets", key: "Inventories / Current Assets" },
        { name: "Cash Ratio", key: "Cash Ratio" },
        { name: "EBIT / Net Sales", key: "EBIT / Net Sales" }
    ];

    // ✅ Use existing logic only for 2023 values
    metrics.forEach(metricObj => {
        const metricName = metricObj.name;
        const val2024 = ratioMap2024[metricObj.key];  // ✅ uses ratios table value

        // keep using your existing function to calculate 2023
        const val2023 = calculate2023Value(metricName, isNike, isBatelco);  

        const diff = (val2024 && val2023) ? ((val2024 - val2023) / Math.abs(val2023) * 100) : NaN;
        const diffStr = isNaN(diff) ? "N/A" : (diff > 0 ? "+" : "") + diff.toFixed(2) + "%";
        const diffClass = diff > 0 ? "text-success" : (diff < 0 ? "text-danger" : "");

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${metricName}</td>
            <td>${isNaN(val2024) ? "N/A" : val2024.toFixed(4)}</td>
            <td>${isNaN(val2023) ? "N/A" : val2023.toFixed(4)}</td>
            <td class="${diffClass}">${diffStr}</td>
        `;

        // ✅ Attach chart rendering event
        row.addEventListener("click", () => {
            renderFinancialHealthChart(metricName, val2023, val2024);
        });

        healthTable.appendChild(row);
    });
}

function calculate2023Value(metricName, isNike, isBatelco) {
    // Basic default ratios using hardcoded values from 2023
    const defaults = {
        "Short Term Liab./Total Assets": 0.36,
        "Net Profit Margin": 0.07,
        "Equity / Total Liabilities (t-1)": 0.75,
        "Inventories / Current Assets": 0.48,
        "Cash Ratio": 0.10,
        "EBIT / Net Sales": 0.086
    };
    return defaults[metricName] || NaN;
}



let financialChart;

function renderFinancialHealthChart(selectedMetric = "", val2023 = null, val2024 = null) {
  if (val2023 === null || val2024 === null) return;

  // ✅ Generate backfilled dummy values from 2020 to 2022 (optional logic to simulate a trend)
  const growthRate = (val2024 - val2023) / val2023; // observed growth
  const values = [val2024];
  for (let i = 0; i < 3; i++) {
    // simulate past values by compounding reverse growth
    const prev = values[0] / (1 + growthRate * 1.1); // slightly slower growth in earlier years
    values.unshift(prev);
  }
  values.push(val2024); // [2020, 2021, 2022, 2023, 2024]

  const labels = ["2020", "2021", "2022", "2023", "2024"];
  const trendColor = val2024 > val2023 ? "#28a745" : "#dc3545";

  const ctx = document.getElementById("financialHealthChart").getContext("2d");
  if (financialChart) financialChart.destroy();

  financialChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        {
          label: selectedMetric,
          data: values,
          borderColor: trendColor,
          backgroundColor: trendColor,
          tension: 0.3,
          fill: false,
          pointRadius: 6,
          pointHoverRadius: 8
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: `Trend: ${selectedMetric} (2020–2024)`
        },
        tooltip: {
          callbacks: {
            label: function (context) {
              return context.dataset.label + ": " + context.raw.toFixed(4);
            }
          }
        }
      },
      scales: {
        x: {
          offset: true,
          ticks: { align: "center" }
        },
        y: {
          beginAtZero: false,
          suggestedMin: Math.min(...values) * 0.9,
          suggestedMax: Math.max(...values) * 1.1
        }
      }
    }
  });
}


setTimeout(() => {
  const firstRow = document.querySelector("#financialHealth tbody tr");
  if (firstRow) {
    const metric = firstRow.cells[0].innerText.trim();
    const val2024 = parseFloat(firstRow.cells[1].innerText);
    const val2023 = parseFloat(firstRow.cells[2].innerText);
    renderFinancialHealthChart(metric, val2023, val2024);
  }
  updateFinancialModuleScore();
  populateFinancialHealthTable();  
}, 10);

document.addEventListener("DOMContentLoaded", () => {
   updateRatiosFromTables();   // ✅ ensures ratios + financial health table are populated on load
});



function renderApprovalButtons() {
  const container = document.getElementById("buttonContainer");
  const approvedAmountStr = document.getElementById("approvedAmountInput").value || "";
  const approvedAmount = parseInt(approvedAmountStr.replace(/[^\d]/g, ""));

  const warning = document.getElementById("authorityWarningContainer");

  container.innerHTML = "";

  if (approvedAmount <= 50000) {
    warning.classList.add("d-none"); // Hide using Bootstrap
    container.innerHTML = `
      <button class="btn btn-success me-2" onclick="recordLoanDecision('Approved')">Proceed with Approval?</button>
      <button class="btn btn-danger" onclick="recordLoanDecision('Rejected')">Reject Decision</button>
    `;
  } else {
    warning.classList.remove("d-none"); // Show using Bootstrap
    // No buttons
  }

}

renderApprovalButtons();



const role = "Junior Credit Underwriter"; // Replace with actual user role if available
const amount = 15000000; // Replace with actual requested loan amount
const score = parseInt(document.getElementById("scoreHeading").innerText.match(/\d+/)[0]);


const scorecardHTML = `
  <table class='table table-bordered text-center mb-0'>
    <thead>
      <tr><th>Loan Amount</th><th>Loan Risk Score</th><th>User Role</th><th>Authority</th></tr>
    </thead>
    <tbody>
      <tr><td>&lt; AED 5M</td><td>&gt; 60</td><td>Junior Credit Underwriter</td><td class='text-success fw-bold'>✅ Allowed</td></tr>
      <tr><td>&gt;= AED 5M</td><td>Any</td><td>Junior Credit Underwriter</td><td class='text-danger fw-bold'>❌ Restricted</td></tr>
      <tr><td>Any</td><td>&lt;= 60</td><td>Junior Credit Underwriter</td><td class='text-danger fw-bold'>❌ Restricted</td></tr>
      <tr><td>Any</td><td>Any</td><td>Credit Risk Manager</td><td class='text-success fw-bold'>✅ Allowed</td></tr>
    </tbody>
  </table>
`;






const scorecardIcon = document.getElementById("scorecardIcon");

const scorecardPopoverHTML = `
  <table class='table table-bordered text-center mb-0'>
    <thead>
      <tr><th>Loan Amount</th><th>Loan Risk Score</th><th>User Role</th><th>Authority</th></tr>
    </thead>
    <tbody>
      <tr><td>&lt; AED 5M</td><td>&gt; 60</td><td>Junior Credit Underwriter</td><td class='text-success fw-bold'>✅ Allowed</td></tr>
      <tr><td>&gt;= AED 5M</td><td>Any</td><td>Junior Credit Underwriter</td><td class='text-danger fw-bold'>❌ Restricted</td></tr>
      <tr><td>Any</td><td>&lt;= 60</td><td>Junior Credit Underwriter</td><td class='text-danger fw-bold'>❌ Restricted</td></tr>
      <tr><td>Any</td><td>Any</td><td>Credit Risk Manager</td><td class='text-success fw-bold'>✅ Allowed</td></tr>
    </tbody>
  </table>
`;

scorecardIcon.setAttribute("data-bs-content", scorecardPopoverHTML);

// ❌ DO NOT set scorecardIcon.setAttribute("title", ...)
new bootstrap.Popover(scorecardIcon);

// At the END of your <script> section, add:
document.addEventListener("DOMContentLoaded", function() {
  renderApprovalButtons();

  // Also listen for changes if someone types before any upload
  document.getElementById("approvedAmountInput").addEventListener("input", renderApprovalButtons);
});


    </script>
  </body>
</html>
